<!DOCTYPE HTML>
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
	<title>SuSE 12.2 Linux on a Fujitsu P5020D Lifebook</title>
</head>

<BODY>
<h1>SuSE 12.2 Linux on a Fujitsu P5020D Lifebook</h1>

<p>Last update to this page: 14.10.2010</p>

<p>The amazing thing is that this Laptop that I bought in 2003 is still going strong for me! 
I paid like 2000 CHF for it then and it was quite novel because it was so much smaller than the
usual laptops of the time. Now that I am on the other side of 40 and my eyes need magnification
this isn't as strong a selling point as it used to be. I got it with the maximum amount of memory 
at the time (1GB) and it still serves many tasks gracefully. Of course I have replaced the 2.5mm HDD
to hold all the pictures and stuff that accumulates. The battery has degraded. I loved it when it 
was new and would keep going for most of the day. These days with both batteries in I'm lucky to get
a full hour. Perhaps one of these days I'll get a replacement but since it works fine and can do 
just that bit more than the tablet when away from home I still keep it dusted off and have just 
finished installing OpenSuSE 12.2 on it which works fine.</p>

<p>The rest of the page has been compiled and amended since 2004</p>
    

<h2>Description of the Computer</h2>
<p>The Fujitsu P5020D is a subnotebook I bought in October 2003 that is smaller than your A4 writing pad. It sports a 10.6&quot; wide format screen. Fujitsu of course no longer sell it but here is a link to the most recent model in the series: <a href="http://store.shopfujitsu.com/fpc/Ecommerce/buildseriesbean.do?series=P8020">Fujitsu P8020</a></p>

<img src="p5020d.jpg" alt="Picture of a Fujitsu P5020D laptop running Suse linux" width="500" height="484" border="0">

<p>My P5020D has a removable DVD/CD writer in the combo drive bay. I also got the extra battery which swaps into the place of the optical drive and then gives me about 8 hours of uptime without paying special attention to being battery friendly. The main battery lasts over 3 hours. (That was in 2004 when it was new. Now in 2009 I get something like 2 hours out of the combined batteries and can stretch that a bit if I dim the screen brightness.) Lately my "then" especially large 80GB harddisk started spewing these alarming "sector could not be read" messages into the kernel log so I had to decide on a replacement laptop or replacement disk. I am still happy with the performance of the device so I opted for a 250GB replacement disk.</p>

<p>I am very happy with this little jewel. It weighs only 2kg and has the size of a hardcover book. It fits easily into your luggage and allows you to take 8 other kilograms of stuff onto the plane in your hand luggage allowance. The size is small enough so you can open the lid and work on it in the cramped space of an economy plane seat or backseat of a car.</p>

<p>6 years on I am still very happy with this device. It is still remarkably fast for it's processor speed. The build quality must be rated as excellent. The outside looks a bit worn though if you consider that I has had daily use for 6 years often running 24/7 that must be acceptable. When examined closely one will spot marks on the screen where it touches the keys of the keyboard. I think this must come from the fats that gradually build up on the keyboard which transfer to the screen and etche themselves into the material. Regular LCD cleaners and window cleaner doesn't remove this. A built in microphone would have been nice but then Skype wasn't known when I bought this and it's successors have such a mike and even a camera.</p>

<hr>


<h2>Installation of SuSE 11.1</h2>

<p>When I bought the laptop back in 2003 I shrunk the Windows XP partition to 6GB and loaded SuSE 9.0. In the mean time I've upgraded several times to 11.1 in December 2008. This was the first distro that got everything right (well nearly). In the past there has always been something to struggle with. When I bought it Intel were putting up a silly fight with not realeasing the specs on their Centrino WiFi chips. As a result I made sure I got the D series which had the Atheros chip for which a temperamental driver did exist. The Video Bios is programmed wrongly and the video driver writer never wanted to compromise his code with hacks to extend to the 1280 width instead of the 1024 with black bars on the side. I always had to pre-load a patch to trick this into working, And I never really got that working right in the boot sequence. All of this is now fixed. This is a marvellous distro!</p>

<hr>
<h2>What I had trouble with:</h2>
<h3>IPV6</h3>
<p>Whilst everything installed fine once the laptop was booted no applications could resolve addresses on the Internet. Ping, traceroute, did and nslookup all worked fine but Firefox, Yast2 software updater etc. all failed. Eventually I went into the Yast2 network card settings and ticked off IPV6 and everything started working after a reboot.</p>

<h3>Output volume</h3>
<p>For some strange reason the volume of the internal speakers is not controlled by the master volume mix-slider. Instead it is the slider labelled "Headphone". Once you know this you are fine. The volume function keys control the PCM volume. If the "Headphones" have no juice you will hear nothing. The slider also controlls the volume on the headsphone jack.</p>

<h3>The network interface</h3>
<p>Back in 2004 noticed the strange behaviour that the notebook sometimes would boot up without the network interface and nothing would convince it to turn it on other then rebooting with the network cable plugged in. Eventually I tracked this behaviour down to the BIOS. There is a setting under Advanced Options which when set to Auto causes this. If it is set to Auto then the LAN interface will only be activated when there is a LAN signal on the wire. This, however, is only done when the Laptop is running from Battery. That's why this was so baffling. Turn this option to "Enabled". You don't want to reboot the laptop just because you decided you wanted to use the Network all of a sudden. I have never had the problem since.</p>

<h3>Suspend and Resume</h3>
<p>Finally, finally suspend and resume seems to be working "out of the box" with 11.1.</p>
<p>I noticed some initial wierdness which has gone away as of March 2009: I would hybernate to disk from KDE and then close the lid when everything had nicely shut down. This looks like it triggers a "lid event" as the laptop whirrs into high gear. Perhaps in the first kernel version of 11.1 this was mistaken as a command to start up as I heated my bag up (draining the battery) more than once. As of writing this is no longer an issue. When you open the lid, however, this is identified as a command to wake up from hybernation which will go all the way. Quite amusing if you have an XMMS running at the time of suspend. It stutters to life and then runs on as if nothing had happened.</p>

<h3>Output to SVHS</h3>
<p>I spent some frustrating hours while on 11.0 trying to get video output routed to the SVHS plug. I have a TV set with all sorts of inputs (but no VGA) and it would be nice to hook the laptop up. I once did this in the past on a different TV set and we watched a DVD. But I don't remember if I did this from Windows or Linux and after several hours of mucking about I gave up. If someone can tell me how to do this I would be grateful.</p>

<hr>

<h2>What I used to have trouble with:</h2>

<h3>The <strong>screen resolution of 1280x768. FIXED in 11.1</strong></h3>
<p>The Fujitsu guys botched the Video Bios and it doesn't list the screen's native resolution of 1280x768. Unlike the Windows driver, the Linux driver refuses to use settings that are not mentioned in the VBIOS and we are left with 1024x768. As the developer of the driver has moved on to more exciting projects there seemed little chance of this ever working.  There is a commercial closed source driver available from <a href="http://www.xig.com">Xig</a> which costs a small amount of money. I tried to install the demo but failed because I hadn't set up a compilable Kernel.</p>

<p>However, Andrew Tipton figured out a way round this. He wrote a tiny program that copies the VBIOS into RAM and then adds the missing video mode. After this is run the driver has no problems using the extra pixels.</p>

<p>Check this discussion for the full story: <a href="http://www.leog.net/fujp_forum/topic.asp?TOPIC_ID=5371">http://www.leog.net/fujp_forum/topic.asp?TOPIC_ID=5371</a><br>
As the original URL no longer worky I have put the version I pulled here: <a href="1280patch.c">1280patch.c</a><br>
You compile the patch with the command: gcc -o 1280patch 1280patch.c<br>
Make it executable: chmod a+x 1280patch<br>
You execute it with the command: ./1280patch.c<br>
You must be root to do this. In order for the XFree86 driver to use the mode correctly it needs to have the following statements in your /etc/X11/XF86Config:</p>
<pre>Section "Monitor"
Identifier "internal_panel"
Modeline "1280x768" 80.14 1280 1344 1480 1680 768 769 772 795
EndSection</pre>
<p>Here is my current /etc/X11/XF86Config file. Beware thought that I might have stuff configured you don't want. <a href="XF86Config.p5020d">XF86Config.p5020d</a><br>
In order to have the patch started automatically I cannibalised an init script. Each distro boots differently but if you have SuSE and want to do what I did, put the compiled patch into /etc/X11/ as 1280patch. Then write an init script to start it or use mine: <a href="videopatch">videopatch</a>. This goes into /etc/init.d Then call up the Yast2 runlevel Editor and tell it in Expert Mode that you want this script run in runlevel 3.</p>
<p>Well done Andrew!</p>

<p>By the way: To switch from the stretched view of the 1024 to the non stretched view you press Fn-F5.</p>

<p>Update from May 2007: While reviewing this page I discovered that Alain Poirier has written a more generic utility to change the resolution. I haven't tried it but it sounds promissing: <A href="http://perso.orange.fr/apoirier/">http://perso.orange.fr/apoirier/</a></p>

<p>Update from Feb 2008: Apparently the latest X.org driver should handle this annoying resolution problem. Unfortunately I could not get this to work as desired and gave up after an hour or so.</p>


<h3>M-Identity</h3>
<p>The Swiss Migros-Bank has a new way for their clients to log in: They sent round USB sticks with a special version of Firefox on them and some sort of crypto smart card. The idea is that you stick this into your PC and can then start up their browser with all it's crypto stuff, enter a password and do your banking. Annoyingly this didn't work for me for the longest time. SuSE 11.0 couldn't handle it. XP on the laptop had some M$ issue and didn't work. My main machine didn't like it because Java and 64 bit had issues. Only my server could do it but that machine is for server stuff, not banking! I'm glad to report with SuSE 11.1 this works everywhere now.</p>

<h3>The sound up / down buttons</h3>
<p>While updating this page I checked this out in my new SuSE 11.1. It's not something I really use. But I was very impressed that SuSE actually trap the specially marked function keys and perform the correct actions on the mixer! Fn-F3 mutes and unmutes the volume, Fn-F8 decreases and Fn-F9 increases the volume. Thank you SuSE! For those that might have an interest in mapping the keyboard please read on.</p>
<p>On prior SuSE releases added </p><pre>
! mute
keycode 160 = F30

!volume down
keycode 174 = F31

! volume up
keycode 176 = F32

!windows key
keycode 115 = F33

! menu key
keycode 117 = F34
</pre>
to my /usr/X11R6/lib/X11/Xmodmap file and to the file /usr/X11R6/lib/X11/etc/xmodmap.std  This maps the
keycodes to the F30 through F34 buttons. Then in KDE you can set up shortcuts.
This sounds simple. It wasn't. I had to add a menu entry for Volume up, Volume
down, and Volume Mute. These had to be associated with a script which then calls
<pre>
amixer set Headphone 5%+
amixer set Headphone 5%-
amixer set Headphone toggle
</pre>
<p>respectively. To these menu items you associate the key bindings created above by pressing Fn-F9, Fn-F8, Fn-F3 respectively.</p>


<h3>Listening to Webradio</h3>
<p><a href="http://www.radioplay.ch/">http://www.radioplay.ch/</a> This was caused by mplayer not being installed and it is not part of the distro. Download recent rpm's from the web and kill artsd for this to work. Also you must start mozilla from the command line and not background (&amp;) it because it doesn't work then.</p>
<p>These days you need to attach the packman repository.</p>



<h3>Wireless</h3>
<p>I deliberately got myself the P5020<strong>D</strong> version of the computer. This has the Pentium M processor but not the Centrino wireless chip. Intel refused for a long time to release the specification for that wireless chip and also refused to provide a linux driver. I understand there is a binary driver out there now but it stopped me giving them any money at the time.</p>

<p>Unfortunately getting the Atheros chip to work was not at all easy. I spend many an hour compiling the driver, especially after each kernel upgrade. Frustration also kicked in after the upgrade to SuSE 10.1 when it stubbornly refused to work. (That was eventually solved with a <code>iwpriv ath0 authmode 1</code> command)</p>

<p>Under SuSE 10.2 this seems to have become easy. You need to install the madwifi packages. Fortunately they are precomfiled and sitting on this location: <A href="http://madwifi.org/suse/">http://madwifi.org/suse/</A> In particular be sure not just to install the main madwifi rpm but also the one with the kernel in it's name. For me that was madwifi-kmp-default-0.9.3_2.6.18.8_0.2-6.1.i586.rpm</p>
<p>I loaded the modules into the kernel by running <code>modprobe ath_hal</code> and <code>modprobe ath_pci</code> but it might have done with after the next reboot anyway  I then used <code>yast2</code> to set up the Network Cards. I decided to give the network manager a try. Magically a little icon shows up in the taskbar and it shows you all your interfaces and shows you the wireless access points nearby. You can add the WEP key and off you go. It seems to allow only one interface at a time (so either the cabled ethernet or the wireless interface) but for everyday travelling use that seems adequate.</p>


<h3>CF Card Slot</h3>
<p>Setting up the CF-Card reader was surprisingly easy. Plug the CF card into
the slot and the Kernel recognises the card and assigns it a device. This is
/dev/hdc1 on my machine. It did use /dev/hde1 for a while. This might be when I
have the CD drive inserted instead of the extra battery. To mount the CF card
all I needed was a line like this in /etc/fstab and then I could simply mount
and unmount the device. I believe my Nikon D100 camera formats the CF card along
some sort of Microsoft Operating system mapping which is why vfat works
fine.</p>
<pre>
/dev/hdc1            /media/cfcard         vfat       ro,noauto,user,exec   0 0

mount /media/cfcard
umount /media/cfcard
</pre>

<h3>CD Burner</h3>
<p>I was a bit apprehensive as I've had trouble with CD burners in the past.
This was entirely unfounded as K3B happily wrote 700 MB to a CD with no problems
at all. The drive reads DVD's with no issues and ripping mp3's with grip gave no
hassles and identified the tracks via FreeDDB neatly.</p>
<p>The Fujitsu P5020D really dislikes having the CD drive removed while the
computer is running. This is a quick way to halt your system. It reboots OK if
you press the power button for 4 seconds. I'm not sure if this the laptop's
fault or if the Kernel dislikes this so badly it hangs but don't try this at
home.</p>
<p>Update from the SuSE 9.1 upgrade: See above. I had trouble with the 2.6
Kernel recognising the drive.</p>

<h3>USB Floppy</h3>
<p>This was really easy: I plugged the USB cable in. The P5020D went bling and a lot of stuff was written to the kernel messages file. Quite by magic an entry was appended to the /etc/fstab. All I had to do was insert a floppy and mount the directory and all was fine! Someone has spent some serious effort to make this easy! Thanks!</p>

<h3>Modem</h3>
<p>I picked up the details from
<a href="http://chaosengine.net/p5020d">here</a> (archived to <a href="http://web.archive.org/web/20060101032638/http://chaosengine.net/p5020d">here</a>). Basically you download the tar file from this site: 
gone: ftp://ftp.smlink.com/linux/unsupported"
Then read the README, do a <code>make</code> and <code>make
install</code> as root. Every time you want to use the modem you then must run
the command: <code>slmodemd --country=SWITZERLAND /dev/slamr0</code>. This sets
up a device called <code>/dev/ttySL0</code> (watch the spelling; it's not ttyS0)
which wvdial can then use. It works.</p>

<p>Update from the SuSE 9.1 upgrade: simply install the modem with YaST2. It
decides it wants to install the package <code>smartlink-softmodem</code>.
Then you can run the command above and wvdial and use dialup connections.</p>

<p>Thankfully we don't have to bother with modems any more these days (Oct 2012)</p>

<h3>USB Mouse</h3>
<p>I simply attached my Logitech optical mouse to the USB port. The YaST2 mouse
module connects it nicely to my X server and that works. The touchpad and
buttons connect nicely when you tell that YaST2 module that you are using the
"PS/2 mouse - Aux-port".</p>

<h3>Second Mouse</h3>
<p>I'm not such a big fan of the touchpad mouse. It's fine on planes but otherwise I'd rather use my Logitech optical mouse. I was constantly switching between the two with <code>yast2 mouse</code> in supervisor mode. You can have both mice active at the same time if you change your <code>/etc/X11/XF86Config</code> to have an entry for both mice:</p>
<pre>
Section "InputDevice"
  Driver       "mouse"
  Identifier   "Mouse[1]"
  Option       "Device" "/dev/mouse"
  Option       "Emulate3Buttons" "on"
  Option       "Name" "Autodetection"
  Option       "Protocol" "PS/2"
  Option       "Vendor" "Sysp"
  Option       "ZAxisMapping" "4 5"
EndSection

Section "InputDevice"
  Driver       "mouse"
  Identifier   "Mouse[2]"
  Option       "ButtonNumber" "2"
  Option       "Device" "/dev/input/mice"
  Option       "Name" "Autodetection"
  Option       "Protocol" "imps/2"
  Option       "Vendor" "Sysp"
  Option       "ZAxisMapping" "4 5"
EndSection
</pre>

<p>And then you need to add the second mouse to the server layout section like this:</p>

<pre>
Section "ServerLayout"
  Identifier   "Layout[all]"
  InputDevice  "Keyboard[0]" "CoreKeyboard"
  InputDevice  "Mouse[1]" "CorePointer"
  InputDevice  "Mouse[2]" "AlwaysCore"
  Option       "Clone" "off"
  Option       "Xinerama" "off"
  Screen       "Screen[0]"
EndSection
</pre>

<h3>Playing DVD movies and DivX rips</h3>
<p>SuSE are scared of all the licensing issues surrounding Multimedia codecs
and DVD decoding and such. So they distribute an old version of Xine with
old codecs. Download the SuSE 9.1 packages for xine from <A
href="http://packman.links2linux.org">packman.links
2linux.org</A> instead. Also install the MPlayer stuff from there too.</p>


<h3>Suspend / Resume</h3>
<p>Finally with SuSE 9.1 and Kernel 2.6 this works! The only gotcha was that
the 1280 video patch isn't running when the system comes back up and half
your desktop has disappeared. I found some comments using Google and
essentially all you need to do is run a script like the following:</p>
<pre>
#!/bin/bash
echo 4 > /proc/acpi/sleep
/etc/rc.d/videopatch start
</pre>
<p>Of course this assumes you have set up an init script videopatch that you
can run as part of system startup that calls the patch. Here's mine: <a
href="videopatch">videopatch</a></p>

<hr>
<h2>Other Resources:</h2>
<p>Michael Leuchtenburg installed Gentoo onto the P5020D: <a href="http://web.archive.org/web/20070218045020/http://slashhome.org/tech/p5020d/">http://web.archive.org/web/20070218045020/http://slashhome.org/tech/p5020d/</a><br>
Another guy with useful comments: <a href="http://web.archive.org/web/20060101032638/http://chaosengine.net/p5020d">http://web.archive.org/web/20060101032638/http://chaosengine.net/p5020d</a><br>
</p>

<hr>
<p>Off topic but before I forget and for the aid of others:</p>

<h3>How to redirect sound to another machine using KDE and aRtsd</h3>
<p>It is possible to make your sound generating application send the sound to another computer. First you must make the machine that is to play the sound (the one with the soundcard that might be connected to your HiFi) accept sound being sent to it. It needs to run the artsd daemon in networking mode and it needs to be listening on a TCP port.</p>
<p>To set up the sound playing computer open the KDE Control Center and go to Sound System. On the General tab click on "Enable networked sound". On the Hardware tab tick on the "Use other custom options" and add the options -p 5001 -u</p>
<p>Hardcore shell users can also start artsd with something like <code>artsd -n -u -p 5001</code> Basically this tells artsd to use networked sound (-n), have no protection (!) (-u) and work via port 5001 (-p 5001).</p>
<p>The computer that wants to send the sound needs to tell it's artsd to send the sound to the target machine. You do this by setting the Environment ALSA_SERVER to the target. Such as: <code>export ALSA_SERVER=192.168.0.5:5001</code> </p>
<p><strong>Note:</strong> I've received 2 mails telling me it's ARTS_SERVER that you need to set,  not ALSA_SERVER. This makes sense as you are dealing with ARTS. Sadly arts isn't working right on the  latest upgrade to Suse 10.0 so I can't verify this at the moment (Jan 2006)</p>
<p>Then start your favorite sound application. Note: if this is xmms make sure it is sending it's output to aRts in the options.</p>
<p>You could use this to send the sound from your laptop to a computer attached to your Stereo that has very little disk capacity. You could send sound from your media server to your workstation. Of course you can also ssh -XC to the target machine and run the application there if you have the media there. This offers interesting possibilities.</p>

<hr>

<p>I do appreciate feedback. Please let me know if you have better ideas how to do things, if I've gotten things wrong or should include other references.</p>

<p>My email address is: <a href="mailto:richard.eigenmann@gmail.com">richard.eigenann@gmail.com</a></p>

<P>Copyright 2004-20012 Richard Eigenmann, Z&uuml;rich<br>
Homepage: <a href="http://richieigenmann.users.sourceforge.net/">http://richieigenmann.users.sourceforge.net/</a></p>
<p>
   <a href="http://validator.w3.org/check?uri=referer"><img
        src="http://www.w3.org/Icons/valid-html401-blue"
        alt="Valid HTML 4.01 Transitional" height="31" width="88"></a>
  </p>




</body>
</html>